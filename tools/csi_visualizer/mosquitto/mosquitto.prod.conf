# Mosquitto MQTT Broker Configuration for Wavira (Production)
# Dual listener: MQTT (1883) for ESP32, WebSocket (9001) for browsers
# Security-hardened configuration

# =============================================================================
# MQTT Listener (for ESP32 devices and backend services)
# =============================================================================
listener 1883 0.0.0.0
protocol mqtt

# =============================================================================
# WebSocket Listener (for browser clients via MQTT.js)
# =============================================================================
listener 9001 0.0.0.0
protocol websockets

# =============================================================================
# Authentication (REQUIRED for production)
# =============================================================================
# IMPORTANT: Set allow_anonymous to false in production
allow_anonymous false

# Password file (generate with: mosquitto_passwd -c /mosquitto/config/passwords.txt username)
password_file /mosquitto/config/passwords.txt

# =============================================================================
# TLS/SSL Configuration (recommended for production)
# =============================================================================
# Uncomment and configure for TLS:
# listener 8883 0.0.0.0
# protocol mqtt
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key
# cafile /mosquitto/certs/ca.crt
# require_certificate false

# WebSocket with TLS:
# listener 9002 0.0.0.0
# protocol websockets
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key

# =============================================================================
# Access Control Lists (ACL)
# =============================================================================
# Uncomment to enable ACL-based topic access control:
# acl_file /mosquitto/config/acl.conf

# =============================================================================
# Persistence
# =============================================================================
persistence true
persistence_location /mosquitto/data/
autosave_interval 60

# =============================================================================
# Logging
# =============================================================================
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice
# Disable information-level logging in production for performance
# log_type information
connection_messages true
log_timestamp true

# =============================================================================
# Performance Tuning
# =============================================================================
max_connections 1000
max_inflight_messages 20
max_queued_messages 1000
message_size_limit 262144  # 256KB max message size

# =============================================================================
# Retained Messages
# =============================================================================
retain_available true

# =============================================================================
# Security Hardening
# =============================================================================
# Disable $SYS topics for non-admin clients
sys_interval 0
