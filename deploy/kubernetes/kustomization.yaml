# Kustomize Configuration for Wavira
# Usage:
#   kubectl apply -k deploy/kubernetes/
#   kustomize build deploy/kubernetes/ | kubectl apply -f -
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: wavira

# Labels applied to all resources
labels:
  - pairs:
      app.kubernetes.io/name: wavira
      app.kubernetes.io/version: "1.0.0"
      app.kubernetes.io/managed-by: kustomize
    includeSelectors: true

# Namespace for all resources
namespace: wavira

# Resources to include
resources:
  - namespace.yaml
  - configmap.yaml
  - secret.yaml
  - mosquitto-deployment.yaml
  - mosquitto-service.yaml
  - history-collector-deployment.yaml
  - history-collector-service.yaml
  - ingress.yaml

# Images (can be overridden for different environments)
images:
  - name: wavira/history-collector
    newTag: latest
  - name: eclipse-mosquitto
    newTag: "2"

# ConfigMap generator (alternative to static configmap.yaml)
# configMapGenerator:
#   - name: wavira-config
#     literals:
#       - MQTT_HOST=mosquitto
#       - MQTT_PORT=1883

# Secret generator (alternative to static secret.yaml)
# secretGenerator:
#   - name: wavira-secrets
#     literals:
#       - API_KEY=your-secret-key

# Patches for environment-specific customization
# patches:
#   - path: patches/production.yaml
#     target:
#       kind: Deployment
#       name: history-collector
