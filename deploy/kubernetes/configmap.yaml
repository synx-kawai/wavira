---
# Wavira Configuration
# Contains non-sensitive configuration for all services
apiVersion: v1
kind: ConfigMap
metadata:
  name: wavira-config
  namespace: wavira
  labels:
    app.kubernetes.io/name: wavira
    app.kubernetes.io/component: config
data:
  # MQTT Broker Configuration
  MQTT_HOST: "mosquitto"
  MQTT_PORT: "1883"
  MQTT_WEBSOCKET_PORT: "9001"

  # Database Configuration
  DB_PATH: "/app/data/history.db"
  DEVICES_DB_PATH: "/app/data/devices.db"
  DATA_RETENTION_DAYS: "7"

  # API Configuration
  API_PORT: "8080"
  API_PREFIX: "/api/v1"

  # Security Configuration (non-sensitive)
  CORS_ORIGINS: "*"
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_REQUESTS: "100"
  RATE_LIMIT_WINDOW: "60"
  ADD_SECURITY_HEADERS: "true"

  # Logging
  LOG_LEVEL: "INFO"

---
# Mosquitto Broker Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  namespace: wavira
  labels:
    app.kubernetes.io/name: wavira
    app.kubernetes.io/component: mosquitto
data:
  mosquitto.conf: |
    # Mosquitto MQTT Broker Configuration for Wavira
    # Dual listener: MQTT (1883) for ESP32, WebSocket (9001) for browsers

    # MQTT Listener (for ESP32 devices and backend services)
    listener 1883 0.0.0.0
    protocol mqtt

    # WebSocket Listener (for browser clients via MQTT.js)
    listener 9001 0.0.0.0
    protocol websockets

    # Authentication
    # For production, configure password_file or use authentication plugin
    allow_anonymous true

    # Persistence
    persistence true
    persistence_location /mosquitto/data/
    autosave_interval 60

    # Logging
    log_dest stdout
    log_type error
    log_type warning
    log_type notice
    log_type information
    connection_messages true
    log_timestamp true

    # Performance Tuning
    max_connections -1
    max_inflight_messages 20
    max_queued_messages 1000
    message_size_limit 0

    # Retained Messages
    retain_available true
