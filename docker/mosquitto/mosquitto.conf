# Mosquitto Configuration for Wavira
# https://mosquitto.org/man/mosquitto-conf-5.html

# =============================================================================
# General Settings
# =============================================================================

# Process ID file
pid_file /var/run/mosquitto/mosquitto.pid

# Persistence
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# Default Listener (Plain TCP - Development)
# =============================================================================

listener 1883
protocol mqtt

# Allow anonymous connections (development only)
# Set to false and configure password_file for production
allow_anonymous false

# Password file for authentication
password_file /mosquitto/config/passwd

# ACL file for authorization
acl_file /mosquitto/config/acl

# =============================================================================
# TLS Listener (Production)
# =============================================================================

# Uncomment for TLS support
# listener 8883
# protocol mqtt
# cafile /mosquitto/certs/ca.crt
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key
# require_certificate false
# tls_version tlsv1.2

# =============================================================================
# WebSocket Listener (Dashboard)
# =============================================================================

listener 9001
protocol websockets

# =============================================================================
# Connection Settings
# =============================================================================

# Maximum number of client connections
max_connections -1

# Maximum inflight messages
max_inflight_messages 20

# Maximum queued messages
max_queued_messages 1000

# Message size limit (256KB)
message_size_limit 262144

# =============================================================================
# Keep Alive
# =============================================================================

# Maximum keepalive interval (seconds)
max_keepalive 120

# =============================================================================
# Session Settings
# =============================================================================

# Persistent client expiration (30 days)
persistent_client_expiration 30d

# Auto ID prefix for anonymous clients
auto_id_prefix wavira_auto_

# =============================================================================
# Performance Tuning
# =============================================================================

# Set this to the number of CPU cores
# sys_interval 10
